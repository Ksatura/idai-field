<template #deleteModal let-c="close">
    <div class="modal-body">
        <p *ngIf="selected.length > 1">Möchten Sie die {{selected.length}} markierten Bilder wirklich löschen?</p>
        <p *ngIf="selected.length == 1">Möchten Sie das markierte Bild wirklich löschen?</p>
    </div>
    <div class="modal-footer">
        <button type="button" id="delete-images-confirm" class="btn btn-danger" (click)="c('delete')">Löschen</button>
        <button type="button" id="delete-images-cancel" class="btn btn-default" (click)="c('cancel')">Abbrechen</button>
    </div>
</template>

<template #linkModal let-c="close">
    <div class="modal-body">
        <p>Zu verknüpfende Ressource wählen:</p>
        <document-picker (documentSelected)="documentSelected($event)" [filters]="defaultFilters"></document-picker>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-default" (click)="c('cancel')">Abbrechen</button>
    </div>
</template>

<div (dragover)="false"
     (dragleave)="false"
     (drop)="false">

    <div class="navbar navbar-light bg-faded">
        <search-bar *ngIf="!selected.length"
                    [showFiltersMenu]="false"
                    [defaultFilters]="defaultFilters"
                    (onQueryChanged)="queryChanged($event)">
        </search-bar>

        <span *ngIf="selected.length">
            <div class="btn-group" role="group">
                <button type="button" id="delete-images" class="btn btn-danger" (click)="openDeleteModal(deleteModal)">
                    <span class="mdi mdi-delete"></span>
                </button>
                <button type="button" class="btn btn-primary" (click)="openLinkModal(linkModal)">
                    <span class="mdi mdi-link"></span>
                </button>
            </div>
            <button id="deselect-images" type="button" class="btn btn-default" (click)="clearSelection()">
                Auswahl aufheben
            </button>
        </span>
    </div>

    <div class="image-grid" (window:resize)="onResize($event)">

        <div *ngFor="let row of rows; let index = index">

            <div *ngFor="let cell of row; let ind = ind"
                 class="cell-container"
                 [style.width.px]="cell['calculatedWidth'] + 1"
                 [style.height.px]="cell['calculatedHeight'] + 30">

                <div *ngIf="cell['document'].id == 'droparea'"
                     class="droparea-container"
                     [style.width.px]="cell['calculatedWidth']"
                     [style.height.px]="cell['calculatedHeight']">
                    <drop-area
                            (onImageUploaded)="refreshGrid()"
                            (onUploadError)="showUploadErrorMsg($event)">
                    </drop-area>
                </div>

                <div *ngIf="cell['document'].id != 'droparea'"
                     (click)="select(cell['document'])"
                     (dblclick)="navigateTo(cell['document'])"
                     [id]="'resource-' + cell['document'].resource.identifier"
                     class="cell"
                     [class.selected]="selected.includes(cell['document'])">

                    <div class="identifier"
                         *ngIf="cell['calculatedWidth'] > 30 && cell['calculatedHeight'] > 30"
                         [style.maxWidth.px]="cell['calculatedWidth']-15">
                        <span class="tag tag-default">{{cell['document'].resource.identifier}}</span>
                    </div>

                    <img *ngIf="cell.imgSrc" [src]="cell.imgSrc"
                         [style.width.px]="cell['calculatedWidth']"
                         [style.height.px]="cell['calculatedHeight']">

                    <div class="title" [style.width.px]="cell['calculatedWidth']">
                        {{cell['document'].resource.shortDescription}}
                    </div>

                </div>

            </div>
        </div>
    </div>

</div>
